<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Daily Briefing</title>
    <style>
        @page {
            size: A4;
            margin: 0.5cm;
            background-color: #1a1a1a;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: #e0e0e0;
            background-color: #1a1a1a;
            margin: 0;
            padding: 10px;
        }

        h1 {
            font-size: 32px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 300;
        }

        h2 {
            font-size: 18px;
            border-bottom: 2px solid #00ADB5;
            /* Teal accent */
            padding-bottom: 8px;
            margin-top: 20px;
            margin-bottom: 15px;
            font-weight: 600;
            letter-spacing: 0.5px;
            color: #00ADB5;
            text-transform: uppercase;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .section {
            width: 48%;
            margin-bottom: 20px;
        }

        .full-width {
            width: 100%;
        }

        /* Weather */
        .wind-arrow {
            display: inline-block;
            font-size: 14px;
            transform-origin: center;
        }

        a {
            color: inherit;
            text-decoration: none;
            border-bottom: 1px dotted #888;
        }

        .weather-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .weather-item {
            background-color: #252525;
            padding: 10px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #333;
        }

        .weather-value {
            font-size: 18px;
            font-weight: bold;
        }

        .weather-label {
            font-size: 12px;
            color: #aaa;
            margin-top: 4px;
        }

        /* Stocks */
        .stock-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .stock-name {
            font-weight: bold;
        }

        .stock-price {
            font-family: 'Courier New', monospace;
        }

        .green {
            color: #4caf50;
        }

        .red {
            color: #f44336;
        }

        .grey {
            color: #888;
        }

        /* News */
        .news-item {
            margin-bottom: 12px;
            background-color: #252525;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #333;
        }

        .news-title {
            font-weight: 500;
            margin-bottom: 0;
            font-size: 15px;
            line-height: 1.5;
        }

        .news-title a {
            color: #ececec;
            text-decoration: none;
            border: none;
            display: block;
            /* Make the whole block clickable/fill space */
        }

        .news-summary {
            font-size: 14px;
            color: #aaa;
            line-height: 1.4;
            margin-top: 5px;
        }

        /* Footer */
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 10px;
            color: #555;
        }
    </style>
</head>

<body>
    <h1>{{ date }} <span style="font-size: 0.5em; color: #555; vertical-align: middle;">{{ "%.1f"|format(year_percent)
            }}%</span></h1>
    <div class="container">
        <!-- TOP ROW: Weather & Stocks -->
        <div class="section">
            <h2>Weather (Copenhagen)</h2>
            {% if weather %}
            <div class="weather-grid" style="grid-template-columns: 1fr 1fr 1fr;">
                <div class="weather-item">
                    <div style="font-style: italic; font-size: 18px; margin-bottom: 5px; color: #aaa;">Morning</div>
                    <div class="weather-icon" style="font-size: 24px;">{{ weather.morning.icon }}</div>
                    <div class="weather-value">{{ weather.morning.temp }}°C</div>
                    <div class="weather-label">
                        <!-- Dynamic Size: 14px base + 0.8 * wind_speed. Max cap check not strictly needed for typical winds but keeps it sane -->
                        <span class="wind-arrow"
                            style="transform: rotate({{ weather.morning.wind_dir }}deg); font-size: {{ 14 + (weather.morning.wind * 0.8) }}px;">⬇</span>
                        <span style="font-size: 18px; font-weight: bold;">{{ weather.morning.wind }}</span> km/h
                    </div>
                </div>
                <div class="weather-item">
                    <div style="font-style: italic; font-size: 18px; margin-bottom: 5px; color: #aaa;">Afternoon</div>
                    <div class="weather-icon" style="font-size: 24px;">{{ weather.afternoon.icon }}</div>
                    <div class="weather-value">{{ weather.afternoon.temp }}°C</div>
                    <div class="weather-label">
                        <span class="wind-arrow"
                            style="transform: rotate({{ weather.afternoon.wind_dir }}deg); font-size: {{ 14 + (weather.afternoon.wind * 0.8) }}px;">⬇</span>
                        <span style="font-size: 18px; font-weight: bold;">{{ weather.afternoon.wind }}</span> km/h
                    </div>
                </div>
                <div class="weather-item">
                    <div style="font-style: italic; font-size: 18px; margin-bottom: 5px; color: #aaa;">Evening</div>
                    <div class="weather-icon" style="font-size: 24px;">{{ weather.evening.icon }}</div>
                    <div class="weather-value">{{ weather.evening.temp }}°C</div>
                    <div class="weather-label">
                        <span class="wind-arrow"
                            style="transform: rotate({{ weather.evening.wind_dir }}deg); font-size: {{ 14 + (weather.evening.wind * 0.8) }}px;">⬇</span>
                        <span style="font-size: 18px; font-weight: bold;">{{ weather.evening.wind }}</span> km/h
                    </div>
                </div>
                <div class="weather-item full-width"
                    style="grid-column: span 3; margin-top: 10px; font-size: 16px; padding: 5px;">
                    Sunrise: {{ weather.sunrise.split('T')[1] }} | Sunset: {{ weather.sunset.split('T')[1] }} | Precip:
                    {{ weather.daily_precip }}%
                </div>
            </div>
            {% else %}
            <div class="weather-item full-width" style="text-align: center; color: #f44336; font-weight: bold;">
                ERROR: Weather data unavailable
            </div>
            {% endif %}
        </div>

        <!-- MARKETS -->
        <div class="section">
            <h2 style="display: flex; justify-content: space-between; align-items: baseline;">Markets <span
                    style="font-size: 1em; color: {{ 'green' if stocks.average_percent >= 0 else 'red' }};">{{
                    "%.2f"|format(stocks.average_percent) }}%</span></h2>
            {% for name, data in stocks.items() %}
            {% if name != 'average_percent' %}
            <div class="stock-item">
                <span class="stock-name">{{ name }}</span>
                <span class="stock-price {{ data.color }}">
                    {{ "%.2f"|format(data.price) }} : <span style="font-size: 1.2em; font-weight: bold;">{{
                        "%.2f"|format(data.percent) }}%</span>
                </span>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- SPACE NEWS-->
    <div class="container">
        <div class="section">
            <h2>Space News</h2>
            {% for item in space_news %}
            <div class="news-item">
                <div class="news-title" style="font-weight: normal; font-size: 14px;"><a href="{{ item.link }}"
                        target="_blank" style="text-decoration: none; border: none;">{{ item.headline }}</a></div>
            </div>
            {% else %}
            <div class="news-item">
                <div class="news-summary" style="font-style: italic; color: #888;">Null</div>
            </div>
            {% endfor %}
        </div>

        <div class="section">
            <h2>Copenhagen Today</h2>
            {% for item in copenhagen %}
            <div class="news-item">
                <div class="news-title" style="font-weight: normal; font-size: 14px;"><a href="{{ item.link }}"
                        target="_blank" style="text-decoration: none; border: none;">{{ item.headline }}</a></div>
            </div>
            {% else %}
            <div class="news-item">
                <div class="news-summary" style="font-style: italic; color: #888;">Null</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- WORLD NEWS-->
    <div class="full-width">
        <h2>World News</h2>
        {% for item in world_news %}
        <div class="news-item">
            <div class="news-title"><a href="{{ item.link }}" target="_blank">{{ item.headline }}</a></div>
        </div>
        {% else %}
        <div class="news-item">
            <div class="news-summary" style="font-style: italic; color: #888;">Null</div>
        </div>
        {% endfor %}
    </div>

    <!-- Quote of the Day -->
    {% if quote %}
    <div
        style="text-align: center; margin-bottom: 25px; padding: 20px; background-color: #222; border-radius: 15px; border-left: 4px solid #00ADB5;">
        <div
            style="font-family: 'Georgia', serif; font-style: italic; font-size: 18px; margin-bottom: 8px; color: #ddd;">
            {{ quote.text }}</div>
        <div
            style="font-size: 12px; font-weight: bold; text-transform: uppercase; color: #00ADB5; letter-spacing: 1px;">
            {{ quote.author }}
        </div>
    </div>
    {% endif %}

</body>

</html>