<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Daily Briefing</title>
    <link rel="stylesheet" href="daily_brief.css">
</head>

<body>
    <h1>{{ date }} | {{ "%.1f"|format(year_percent)}}%</h1>
    <div class="container">
        <!-- WEATHER -->
        <div class="section">
            <h2 style="border-bottom: 2px solid #1da1f2; color: #ffffff;">Weather (Copenhagen)</h2>
            {% if weather %}
            <div class="weather-grid">
                <div class="weather-item">
                    <div style="font-size: 14px; margin-bottom: 2px; color: white;">Morning</div>
                    <div class="weather-icon">{{ weather.morning.icon }}</div>
                    <div class="weather-value">{{ weather.morning.temp }}°C</div>
                    <div class="weather-label">
                        <span class="wind-arrow"
                            style="transform: rotate({{ weather.morning.wind_dir }}deg); font-size: {{ 18 + (weather.morning.wind * 0.8) }}px;">⬇</span>
                        <div class="wind-speed">{{ weather.morning.wind }} km/h</div>
                    </div>
                </div>
                <div class="weather-item">
                    <div style="font-size: 14px; margin-bottom: 2px; color: white;">Afternoon</div>
                    <div class="weather-icon">{{ weather.afternoon.icon }}</div>
                    <div class="weather-value">{{ weather.afternoon.temp }}°C</div>
                    <div class="weather-label">
                        <span class="wind-arrow"
                            style="transform: rotate({{ weather.afternoon.wind_dir }}deg); font-size: {{ 18 + (weather.afternoon.wind * 0.8) }}px;">⬇</span>
                        <div class="wind-speed">{{ weather.afternoon.wind }} km/h</div>
                    </div>
                </div>
                <div class="weather-item">
                    <div style="font-size: 14px; margin-bottom: 2px; color: white;">Evening</div>
                    <div class="weather-icon">{{ weather.evening.icon }}</div>
                    <div class="weather-value">{{ weather.evening.temp }}°C</div>
                    <div class="weather-label">
                        <span class="wind-arrow"
                            style="transform: rotate({{ weather.evening.wind_dir }}deg); font-size: {{ 18 + (weather.evening.wind * 0.8) }}px;">⬇</span>
                        <div class="wind-speed">{{ weather.evening.wind }} km/h</div>
                    </div>
                </div>
                <div class="weather-item full-width"
                    style="grid-column: span 3; margin-top: 5px; font-size: 12px; padding: 4px;">
                    Sunrise: {{ weather.sunrise.split('T')[1] }} | Sunset: {{ weather.sunset.split('T')[1] }} | Precip:
                    {{ weather.daily_precip }}%
                </div>
            </div>
            {% else %}
            <div class="weather-item full-width" style="text-align: center; color: #f44336; font-weight: bold;">
                ERROR: Weather data unavailable
            </div>
            {% endif %}
        </div>

        <!-- MARKETS -->
        <div class="section">
            <h2
                style="border-bottom: 2px solid #ffffff; color: #ffffff; display: flex; justify-content: space-between; align-items: baseline;">
                Markets <span style="font-size: 1em; font-family: 'Courier New', monospace; color: {{ 'green' if stocks.average_percent >= 0 else 'red' }};">{{
                    "%.2f"|format(stocks.average_percent) }}%</span></h2>
            {% for name, data in stocks.items() %}
            {% if name != 'average_percent' %}
            <div class="stock-item">
                <span class="stock-name">{{ name }}</span>
                <span class="stock-price {{ data.color }}">
                    {{ "%.2f"|format(data.price) }} : <span style="font-size: 1.2em; font-weight: bold;">{{
                        "%.2f"|format(data.percent) }}%</span>
                </span>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- X TRENDING (Full Width Middle Section) -->
    <!-- Using a new container for full width -->
    <div class="container" style="margin-top: 10px; margin-bottom: 10px;">
        <div class="section full-width" style="width: 100%;">
            <h2 style="border-bottom: 2px solid #868686; color: #ffffff;">Trending on X</h2>

            {% if x_trending %}
            {% set category_colors = {
            'Science': '#9b59b6',
            'Tech': '#3498db',
            'World News': '#e74c3c',
            'World Politics': '#e67e22',
            'Copenhagen / Denmark': '#ff0000',
            'Misc': '#95a5a6'
            } %}

            <!-- Grid for X categories to fill the full width page effectively -->
            <div class="x-grid">
                <!-- x_trending is now a sorted list of tuples: [('Category', [items]), ...] -->
                {% for category, trends in x_trending %}
                <div style="break-inside: avoid;">
                    <div
                        style="font-size: 15px; color: {{ category_colors.get(category, '#888') }}; font-weight: bold; margin-bottom: 6px; letter-spacing: 0.5px;">
                        {{ category }}
                    </div>
                    {% if trends %}
                    {% for item in trends %}
                    <div class="news-item"
                        style="border-left: 3px solid {{ category_colors.get(category, '#1da1f2') }}; margin-bottom: 6px; padding: 8px;">
                        <div class="news-title">
                            <a href="{{ item.link }}" target="_blank" style="text-decoration: none; border: none;">{{
                                item.name }}</a>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-top: 3px;">
                            <div style="font-size: 10px; color: #666;">{{ item.post_count }} posts</div>
                            {% if item.trending_since %}
                            <div style="font-size: 9px; color: #555;">Since {{ item.trending_since }}</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="news-item" style="border-left: 3px solid #333; margin-bottom: 6px; padding: 8px;">
                        <div class="news-summary" style="font-style: italic; color: #666; font-size: 11px;">Nothing
                            trending</div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            {% else %}
            <div class="news-item">
                <div class="news-summary" style="font-style: italic; color: #888;">Null</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- BOTTOM ROW: Copenhagen | World News -->
    <table class="two-column">
        <tr>
            <td class="two-column-cell">
                <div class="section column-section">
            <h2 style="border-bottom: 2px solid #f21d1d; color: #ffffff;">Copenhagen Today</h2>
            {% for item in copenhagen %}
            <div class="news-item">
                <div class="news-title"><a href="{{ item.link }}"
                        target="_blank" style="text-decoration: none; border: none;">{{ item.headline }}</a></div>
            </div>
            {% else %}
            <div class="news-item">
                <div class="news-summary" style="font-style: italic; color: #888;">Null</div>
            </div>
            {% endfor %}

            <!-- SPACE NEWS -->
            <h2 style="border-bottom: 2px solid #0048ff; color: #ffffff;">World News</h2>
            {% for item in world_news %}
            <div class="news-item">
                <div class="news-title"><a href="{{ item.link }}" target="_blank">{{ item.headline }}</a></div>
            </div>
            {% else %}
            <div class="news-item">
                <div class="news-summary" style="font-style: italic; color: #888;">Null</div>
            </div>
            {% endfor %}

                </div>
            </td>

        <!-- RIGHT: World News -->
            <td class="two-column-cell">
                <div class="section column-section">
            <h2 style="border-bottom: 2px solid #ffffff; color: #ffffff; margin-top: 20px;">Space News</h2>
            {% for item in space_news %}
            <div class="news-item">
                <div class="news-title"><a href="{{ item.link }}"
                        target="_blank" style="text-decoration: none; border: none;">{{ item.headline }}</a></div>
            </div>
            {% else %}
            <div class="news-item">
                <div class="news-summary" style="font-style: italic; color: #888;">Null</div>
            </div>
            {% endfor %}
                </div>
            </td>
        </tr>
    </table>


    <!-- Quote of the Day -->
    {% if quote %}
    <div
        style="text-align: center; margin-bottom: 25px; padding: 20px; background-color: #222; border-radius: 15px; border-left: 6px solid #ffee00; border-right: 6px solid #ffee00;">
        <div
            style="font-family: 'Georgia', serif; font-style: italic; font-size: 18px; margin-bottom: 8px; color: #ddd;">
            {{ quote.text }}</div>
        <div
            style="font-size: 12px; font-weight: bold; text-transform: uppercase; color: #ffee00; letter-spacing: 1px;">
            {{ quote.author }}
        </div>
    </div>
    {% endif %}

</body>

</html>
